<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>APIs · ClimaComms.jl</title><meta name="title" content="APIs · ClimaComms.jl"/><meta property="og:title" content="APIs · ClimaComms.jl"/><meta property="twitter:title" content="APIs · ClimaComms.jl"/><meta name="description" content="Documentation for ClimaComms.jl."/><meta property="og:description" content="Documentation for ClimaComms.jl."/><meta property="twitter:description" content="Documentation for ClimaComms.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaComms.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../internals/">Developing with <code>ClimaComms</code></a></li><li><a class="tocitem" href="../threaded/">Threaded</a></li><li><a class="tocitem" href="../logging/">Logging</a></li><li><a class="tocitem" href="../faqs/">Frequently Asked Questions</a></li><li class="is-active"><a class="tocitem" href>APIs</a><ul class="internal"><li><a class="tocitem" href="#Loading"><span>Loading</span></a></li><li><a class="tocitem" href="#Devices"><span>Devices</span></a></li><li><a class="tocitem" href="#Threading"><span>Threading</span></a></li><li><a class="tocitem" href="#Contexts"><span>Contexts</span></a></li><li><a class="tocitem" href="#Logging"><span>Logging</span></a></li><li><a class="tocitem" href="#Context-operations"><span>Context operations</span></a></li><li><a class="tocitem" href="#Collective-operations"><span>Collective operations</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>APIs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>APIs</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaComms.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaComms.jl/blob/main/docs/src/apis.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="APIs"><a class="docs-heading-anchor" href="#APIs">APIs</a><a id="APIs-1"></a><a class="docs-heading-anchor-permalink" href="#APIs" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.ClimaComms" href="#ClimaComms.ClimaComms"><code>ClimaComms.ClimaComms</code></a> — <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia hljs">ClimaComms</code></pre><p>Abstracts the communications interface for the various CliMA components in order to:</p><ul><li>support different computational backends (CPUs, GPUs)</li><li>enable the use of different backends as transports (MPI, SharedArrays, etc.), and</li><li>transparently support single or double buffering for GPUs, depending on whether the transport has the ability to access GPU memory.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/ClimaComms.jl#L1-L11">source</a></section></article><h2 id="Loading"><a class="docs-heading-anchor" href="#Loading">Loading</a><a id="Loading-1"></a><a class="docs-heading-anchor-permalink" href="#Loading" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.@import_required_backends" href="#ClimaComms.@import_required_backends"><code>ClimaComms.@import_required_backends</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">ClimaComms.@import_required_backends</code></pre><p>If the desired context is MPI (as determined by <code>ClimaComms.context()</code>), try loading MPI.jl. If the desired device is CUDA (as determined by <code>ClimaComms.device()</code>), try loading CUDA.jl.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/loading.jl#L37-L42">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.cuda_is_required" href="#ClimaComms.cuda_is_required"><code>ClimaComms.cuda_is_required</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">cuda_is_required()</code></pre><p>Returns a Bool indicating if CUDA should be loaded, based on the <code>ENV[&quot;CLIMACOMMS_DEVICE&quot;]</code>. See <a href="#ClimaComms.device"><code>ClimaComms.device</code></a> for more information.</p><pre><code class="language-julia hljs">cuda_is_required() &amp;&amp; using CUDA</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/loading.jl#L18-L28">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.mpi_is_required" href="#ClimaComms.mpi_is_required"><code>ClimaComms.mpi_is_required</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">mpi_is_required()</code></pre><p>Returns a Bool indicating if MPI should be loaded, based on the <code>ENV[&quot;CLIMACOMMS_CONTEXT&quot;]</code>. See <a href="#ClimaComms.context"><code>ClimaComms.context</code></a> for more information.</p><pre><code class="language-julia hljs">mpi_is_required() &amp;&amp; using MPI</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/loading.jl#L5-L15">source</a></section></article><h2 id="Devices"><a class="docs-heading-anchor" href="#Devices">Devices</a><a id="Devices-1"></a><a class="docs-heading-anchor-permalink" href="#Devices" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.AbstractDevice" href="#ClimaComms.AbstractDevice"><code>ClimaComms.AbstractDevice</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractDevice</code></pre><p>The base type for a device.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L5-L9">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.AbstractCPUDevice" href="#ClimaComms.AbstractCPUDevice"><code>ClimaComms.AbstractCPUDevice</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractCPUDevice()</code></pre><p>Abstract device type for single-threaded and multi-threaded CPU runs.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L12-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.CPUSingleThreaded" href="#ClimaComms.CPUSingleThreaded"><code>ClimaComms.CPUSingleThreaded</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CPUSingleThreaded()</code></pre><p>Use the CPU with single thread.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L20-L24">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.CPUMultiThreaded" href="#ClimaComms.CPUMultiThreaded"><code>ClimaComms.CPUMultiThreaded</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CPUMultiThreaded()</code></pre><p>Use the CPU with multiple thread.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L27-L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.CUDADevice" href="#ClimaComms.CUDADevice"><code>ClimaComms.CUDADevice</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CUDADevice()</code></pre><p>Use NVIDIA GPU accelarator</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L34-L38">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.device" href="#ClimaComms.device"><code>ClimaComms.device</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ClimaComms.device()</code></pre><p>Determine the device to use depending on the <code>CLIMACOMMS_DEVICE</code> environment variable.</p><p>Allowed values:</p><ul><li><code>CPU</code>, single-threaded or multi-threaded depending on the number of threads;</li><li><code>CPUSingleThreaded</code>,</li><li><code>CPUMultiThreaded</code>,</li><li><code>CUDA</code>.</li></ul><p>The default is <code>CPU</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L66-L78">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.device_functional" href="#ClimaComms.device_functional"><code>ClimaComms.device_functional</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ClimaComms.device_functional(device)</code></pre><p>Return true when the <code>device</code> is correctly set up.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L41-L45">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.array_type" href="#ClimaComms.array_type"><code>ClimaComms.array_type</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ClimaComms.array_type(::AbstractDevice)</code></pre><p>The base array type used by the specified device (currently <code>Array</code> or <code>CuArray</code>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L92-L96">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.free_memory" href="#ClimaComms.free_memory"><code>ClimaComms.free_memory</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ClimaComms.free_memory(device)</code></pre><p>Bytes of memory that are currently available for allocation on the <code>device</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L106-L110">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.total_memory" href="#ClimaComms.total_memory"><code>ClimaComms.total_memory</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ClimaComms.total_memory(device)</code></pre><p>Bytes of memory that are theoretically available for allocation on the <code>device</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L113-L117">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.allowscalar" href="#ClimaComms.allowscalar"><code>ClimaComms.allowscalar</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">allowscalar(f, ::AbstractDevice, args...; kwargs...)</code></pre><p>Device-flexible version of <code>CUDA.@allowscalar</code>.</p><p>Lowers to</p><pre><code class="language-julia hljs">f(args...)</code></pre><p>for CPU devices and</p><pre><code class="language-julia hljs">CUDA.@allowscalar f(args...)</code></pre><p>for CUDA devices.</p><p>This is usefully written with closures via</p><pre><code class="language-julia hljs">allowscalar(device) do
    f()
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L221-L242">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.@time" href="#ClimaComms.@time"><code>ClimaComms.@time</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@time device expr</code></pre><p>Device-flexible <code>@time</code>.</p><p>Lowers to</p><pre><code class="language-julia hljs">@time expr</code></pre><p>for CPU devices and</p><pre><code class="language-julia hljs">CUDA.@time expr</code></pre><p>for CUDA devices.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L245-L259">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.@elapsed" href="#ClimaComms.@elapsed"><code>ClimaComms.@elapsed</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@elapsed device expr</code></pre><p>Device-flexible <code>@elapsed</code>.</p><p>Lowers to</p><pre><code class="language-julia hljs">@elapsed expr</code></pre><p>for CPU devices and</p><pre><code class="language-julia hljs">CUDA.@elapsed expr</code></pre><p>for CUDA devices.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L324-L338">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.@assert" href="#ClimaComms.@assert"><code>ClimaComms.@assert</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@assert device cond [text]</code></pre><p>Device-flexible <code>@assert</code>.</p><p>Lowers to</p><pre><code class="language-julia hljs">@assert cond [text]</code></pre><p>for CPU devices and</p><pre><code class="language-julia hljs">CUDA.@cuassert cond [text]</code></pre><p>for CUDA devices.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L344-L358">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.@sync" href="#ClimaComms.@sync"><code>ClimaComms.@sync</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@sync device expr</code></pre><p>Device-flexible <code>@sync</code>.</p><p>Lowers to</p><pre><code class="language-julia hljs">@sync expr</code></pre><p>for CPU devices and</p><pre><code class="language-julia hljs">CUDA.@sync expr</code></pre><p>for CUDA devices.</p><p>An example use-case of this might be:</p><pre><code class="language-julia hljs">BenchmarkTools.@benchmark begin
    if ClimaComms.device() isa ClimaComms.CUDADevice
        CUDA.@sync begin
            launch_cuda_kernels_or_spawn_tasks!(...)
        end
    elseif ClimaComms.device() isa ClimaComms.CPUMultiThreading
        Base.@sync begin
            launch_cuda_kernels_or_spawn_tasks!(...)
        end
    end
end</code></pre><p>If the CPU version of the above example does not leverage spawned tasks (which require using <code>Base.sync</code> or <code>Threads.wait</code> to synchronize), then you may want to simply use <a href="#ClimaComms.@cuda_sync"><code>@cuda_sync</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L265-L298">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.@cuda_sync" href="#ClimaComms.@cuda_sync"><code>ClimaComms.@cuda_sync</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@cuda_sync device expr</code></pre><p>Device-flexible <code>CUDA.@sync</code>.</p><p>Lowers to</p><pre><code class="language-julia hljs">expr</code></pre><p>for CPU devices and</p><pre><code class="language-julia hljs">CUDA.@sync expr</code></pre><p>for CUDA devices.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/devices.jl#L304-L318">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Adapt.adapt_structure-Tuple{Type{&lt;:AbstractArray}, ClimaComms.AbstractDevice}" href="#Adapt.adapt_structure-Tuple{Type{&lt;:AbstractArray}, ClimaComms.AbstractDevice}"><code>Adapt.adapt_structure</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">Adapt.adapt_structure(::Type{&lt;:AbstractArray}, device::AbstractDevice)</code></pre><p>Adapt a given device to a device associated with the given array type.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">Adapt.adapt_structure(Array, ClimaComms.CUDADevice()) -&gt; ClimaComms.CPUSingleThreaded()</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>By default, adapting to <code>Array</code> creates a <code>CPUSingleThreaded</code> device, and there is currently no way to conver to a CPUMultiThreaded device.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/adapt.jl#L21-L35">source</a></section></article><h2 id="Threading"><a class="docs-heading-anchor" href="#Threading">Threading</a><a id="Threading-1"></a><a class="docs-heading-anchor-permalink" href="#Threading" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.@threaded" href="#ClimaComms.@threaded"><code>ClimaComms.@threaded</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@threaded [device] [kwargs...] for ... end</code></pre><p>Device-flexible generalization of <code>Threads.@threads</code>, which distributes the iterations of a for-loop across multiple threads, with the option to control thread coarsening and GPU kernel configuration. Coarsening makes each thread evaluate more than one iteration of the loop, which can improve performance by reducing the runtime overhead of launching additional threads (though too much coarsening worsens performance because it reduces parallelization). The <code>device</code> is either inferred by calling <code>ClimaComms.device()</code>, or it can be specified manually, with the following device-dependent behavior:</p><ul><li><p>When <code>device</code> is a <code>CPUSingleThreaded()</code>, the loop is evaluated as-is. This avoids the runtime overhead of calling <code>Threads.@threads</code> with a single thread, and, when the device type is statically inferrable, it also avoids compilation overhead.</p></li><li><p>When <code>device</code> is a <code>CPUMultiThreaded()</code>, the loop is passed to <code>Threads.@threads</code>. This supports three different kinds of &quot;schedulers&quot; for determining how many iterations of the loop to evaluate in each thread:</p><ol><li>(default) a &quot;dynamic&quot; scheduler that changes the number of iterations as new threads are launched,</li><li>a &quot;static&quot; scheduler that evaluates a fixed number of iterations per thread, and</li><li>a &quot;greedy&quot; scheduler that uses a small number of threads, continuously evaluating iterations in each thread until the loop is completed (only available as of Julia 1.11).</li></ol><p>Setting <code>coarsen</code> to <code>:dynamic</code> or <code>:greedy</code> launches threads with those schedulers. Setting it to <code>nothing</code> or an integer value launches threads with static scheduling (using <code>nothing</code> is similar to using <code>1</code>, but slightly more performant). To read more about multi-threading, see the documentation for <a href="https://docs.julialang.org/en/v1/base/multi-threading/#Base.Threads.@threads"><code>Threads.@threads</code></a>.</p></li><li><p>When <code>device</code> is a <code>CUDADevice()</code>, the loop is compiled with <code>CUDA.@cuda</code> and run with <code>CUDA.@sync</code>. Since CUDA launches all threads at the same time, only static scheduling can be used. Setting <code>coarsen</code> to any symbol causes each thread to evaluate a single iteration (default), and setting it to an integer value causes each thread to evaluate that number of iterations (the default is similar to using <code>1</code>, but slightly more performant). If the total number of iterations in the loop is extremely large, the specified coarsening may require more threads than can be simultaneously launched on the GPU, in which case the amount of coarsening is automatically increased.</p><p>The optional argument <code>block_size</code> is also available for manually specifying the size of each block on a GPU. The default value of <code>:auto</code> sets the number of threads in each block to the largest possible value that permits a high GPU &quot;occupancy&quot; (the number of active thread warps in each multiprocessor executing the kernel). An integer can be used instead of <code>:auto</code> to override this default value. If the specified value exceeds the total number of threads, it is automatically decreased to avoid idle threads.</p></li></ul><p>Any iterator with methods for <code>length</code> and <code>getindex</code> can be used in a <code>@threaded</code> loop, as long as <code>getindex</code> supports one-based linear indexing. All lazy iterators from <code>Base</code> and <code>Base.Iterators</code>, such as <code>zip</code>, <code>enumerate</code>, <code>Iterators.product</code>, and generator expressions, are also compatible with <code>@threaded</code>. (Although these iterators do not define methods for <code>getindex</code>, they are automatically modified by <a href="#ClimaComms.threadable"><code>threadable</code></a> to support <code>getindex</code>.) Using multiple iterators with <code>@threaded</code> is equivalent to looping over a single <code>Iterators.product</code>, with the innermost iterator of the loop appearing first in the product, and the outermost iterator appearing last.</p><p>NOTE: When a value in the body of the loop has a type that cannot be inferred by the compiler, an <code>InvalidIRError</code> will be thrown during compilation for a <code>CUDADevice()</code>. In particular, global variables are not inferrable, so <code>@threaded</code> must be wrapped in a function whenever it is used in the REPL:</p><pre><code class="language-julia-repl hljs">julia&gt; a = CUDA.CuArray{Int}(undef, 100); b = similar(a);

julia&gt; threaded_copyto!(a, b) = ClimaComms.@threaded for i in axes(a, 1)
           a[i] = b[i]
       end
threaded_copyto! (generic function with 1 method)

julia&gt; threaded_copyto!(a, b)

julia&gt; ClimaComms.@threaded for i in axes(a, 1)
           a[i] = b[i]
       end
ERROR: InvalidIRError: ...</code></pre><p>Moreover, type variables are not inferrable across function boundaries, so types used in a threaded loop cannot be precomputed before the loop:</p><pre><code class="language-julia-repl hljs">julia&gt; threaded_add_epsilon!(a) = ClimaComms.@threaded for i in axes(a, 1)
           FT = eltype(a)
           a[i] += eps(FT)
       end
threaded_add_epsilon! (generic function with 1 method)

julia&gt; threaded_add_epsilon!(a)

julia&gt; function threaded_add_epsilon!(a)
           FT = eltype(a)
           ClimaComms.@threaded for i in axes(a, 1)
               a[i] += eps(FT)
           end
       end
threaded_add_epsilon! (generic function with 1 method)

julia&gt; threaded_add_epsilon!(a)
ERROR: InvalidIRError: ...</code></pre><p>To fix other kinds of inference issues on GPU devices, especially ones brought about by indexing into iterators with nonuniform element types, see <a href="https://github.com/CliMA/UnrolledUtilities.jl"><code>UnrolledUtilities.jl</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/threaded.jl#L1-L110">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.@shmem_threaded" href="#ClimaComms.@shmem_threaded"><code>ClimaComms.@shmem_threaded</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@shmem_threaded ... = ...</code></pre><p>Extension of <a href="#ClimaComms.@threaded"><code>@threaded</code></a> for working with shared memory arrays, which can be used immediately before a <code>@threaded</code> loop in the following manner:</p><pre><code class="language-julia hljs">outer_iterator_1 = ...
outer_iterator_2 = ...
...
@threaded device ... begin
    @shmem_threaded inner_iterator = ...
    for outer_item_1 in outer_iterator_1, outer_item_2 in outer_iterator_2, ...
        ...
        array_1 = shmem_array(inner_iterator, ...)
        array_2 = shmem_array(inner_iterator, ...)
        ...
        for inner_item in inner_iterator
            &lt;write to arrays based on inner and outer loop items&gt;
        end
        ...
        for inner_item in inner_iterator
            &lt;read from and write to arrays based on inner and outer loop items&gt;
        end
        ...
        for inner_item in inner_iterator
            &lt;read from arrays based on inner and outer loop items&gt;
        end
        ...
    end
end</code></pre><p>When an iterator variable assignment is annotated with <code>@shmem_threaded</code>, the iterator&#39;s elements are distributed across the threads in each block of a GPU, which have access to the same shared memory arrays. Iterators in the outer <code>@threaded</code> loop are then only distributed across GPU blocks, instead of being distributed across both blocks and threads within the blocks. On CPU devices, which do not provide blocks of threads with access to high-performance shared memory, the <code>@shmem_threaded</code> annotation does nothing.</p><p>An iterator whose assignment is annotated with <code>@shmem_threaded</code> can be used in loops nested inside the outer <code>@threaded</code> loop, with each GPU thread only processing a subset of the iterator&#39;s elements. Coarsening of the inner loops can be controlled by specifying the <code>shmem_coarsen</code> keyword argument for <code>@threaded</code>. Setting <code>shmem_coarsen</code> to <code>:auto</code> causes each thread to process one element of the iterator, and setting it to an integer value causes each thread to process that number of elements.</p><p>When the outer loop is not needed, it can be replaced by a <code>begin ... end</code> expression that is only distributed across the threads in a single GPU block:</p><pre><code class="language-julia hljs">@threaded device ... begin
    @shmem_threaded iterator = ...
    begin ... end
end</code></pre><p>Since an iterator annotated with <code>@shmem_threaded</code> can be used to read data from shared memory arrays, every loop and reduction over the iterator is followed by a call to <a href="#ClimaComms.auto_sync!"><code>auto_sync!</code></a> on GPU devices, ensuring that shared memory reads are consistent across threads.</p><p>When synchronization is not needed after a loop over an iterator annotated with <code>@shmem_threaded</code>, it can be disabled using <a href="#ClimaComms.disable_auto_sync"><code>disable_auto_sync</code></a>. This can always be done for, e.g., the last such loop in a <code>@threaded</code> expression, since there are no subsequent loops that require consistency of shared memory. In general, <code>disable_auto_sync</code> should be called whenever doing so preserves correctness because unnecessary synchronization pauses can degrade performance.</p><p>Since each GPU thread processes a subset of the elements in an iterator annotated with <code>@shmem_threaded</code>, functions that are meant to process the entire iterator, like <code>sum</code> and <code>minimum</code>, would not generate valid results for its subsets. If functions like this need to be evaluated, their results should always be precomputed before <code>@threaded</code> loops.</p><p>When the <code>size</code> of an iterator annotated with <code>@shmem_threaded</code> is used to compute the dimensions of a <a href="#ClimaComms.shmem_array"><code>shmem_array</code></a>, it must be inferrable during compilation to avoid unnecessary runtime allocations. See <a href="https://github.com/JuliaArrays/StaticArrays.jl"><code>StaticArrays.jl</code></a> for how to construct statically-sized analogues of ranges and arrays.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/threaded.jl#L221-L303">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.threaded" href="#ClimaComms.threaded"><code>ClimaComms.threaded</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">threaded(f, device, itrs...; [shmem_threaded], kwargs...)</code></pre><p>Functional form of <a href="#ClimaComms.@threaded"><code>@threaded</code></a>. Depending on whether the <code>@shmem_threaded</code> iterator is specified, this is equivalent to one of the following expressions when <code>n</code> other iterators are provided:</p><pre><code class="language-julia hljs">@threaded device kwargs... begin
    for item_n in itrs[n], ..., item_2 in itrs[2], item_1 in itrs[1]
        f(item_1, item_2, ..., item_n)
    end
end</code></pre><pre><code class="language-julia hljs">@threaded device kwargs... begin
    @shmem_threaded shmem_itr = shmem_threaded
    for item_n in itrs[n], ..., item_2 in itrs[2], item_1 in itrs[1]
        f(item_1, item_2, ..., item_n, shmem_itr)
    end
end</code></pre><p>If only the <code>shmem_threaded</code> iterator is available, this is instead equivalent to the following expression:</p><pre><code class="language-julia hljs">@threaded device kwargs... begin
    @shmem_threaded shmem_itr = shmem_threaded
    begin
        f(shmem_itr)
    end
end</code></pre><p>On single-threaded CPU devices, <code>@threaded</code> and <code>@shmem_threaded</code> annotations are eliminated without any intermediate function calls, so the expressions with macros will typically compile slightly faster than the <code>threaded</code> function. On other devices, the only differences between the macro expressions and the <code>threaded</code> function are syntactic:</p><ul><li>the body of the <code>@threaded</code> loop is specified as a function, with <code>return</code> used in place of <code>continue</code>,</li><li>the <code>@shmem_threaded</code> iterator is specified as a keyword argument,</li><li>every symbol used as a keyword argument is wrapped in a <code>Val</code>, e.g., <code>:auto</code> is specified as <code>Val(:auto)</code>.</li></ul><p>Although the macro expressions are internally converted into <code>threaded</code> function calls, these differences make the functional form somewhat harder to read, so it should generally be avoided.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/threaded.jl#L306-L355">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.threadable" href="#ClimaComms.threadable"><code>ClimaComms.threadable</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">threadable(device, itrs...)</code></pre><p>Modifies one or more iterators so that they each have the following properties:</p><ul><li>a concrete element type</li><li>a well-defined <code>length</code>, and a corresponding method for <code>isempty</code></li><li>support for linear indexing through <code>getindex</code>, with <code>firstindex</code> set to 1</li></ul><p>When no specialized method of <code>threadable</code> is defined for some iterator type, an error will be thrown if the iterator does not already have these properties.</p><p>The <code>threadable</code> version of <code>Iterators.product</code> internally converts linear indices to Cartesian indices with <code>Base.multiplicativeinverse</code> on GPU devices, avoiding inefficient division operations. On CPU devices, this conversion is done using regular integer division.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/threadable.jl#L1-L15">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shareable" href="#ClimaComms.shareable"><code>ClimaComms.shareable</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shareable(itr, device)</code></pre><p>Wrapper for a <a href="#ClimaComms.threadable"><code>threadable</code></a> iterator whose data can be shared across multiple threads on GPU devices. Most methods for iterators and <code>AbstractArray</code>s are forwarded to the underlying <code>itr</code>, but loops and reductions are modified so that each thread only interacts with a subset of the data in <code>itr</code>.</p><p>Specifically, when <code>eachindex</code> is called on a <code>shareable</code> iterator, the threads in each GPU block evenly divide the available indices among themselves. The corresponding methods for <code>map</code>, <code>iterate</code> (which is used by for-loops), and <code>copyto!</code> (which is used by broadcast expressions) all rely on <code>eachindex</code> to specify which items to loop over. Analogues of <code>reduce!</code> and <code>mapreduce!</code>, called <a href="#ClimaComms.shmem_reduce!"><code>shmem_reduce!</code></a> and <a href="#ClimaComms.shmem_mapreduce!"><code>shmem_mapreduce!</code></a>, can also be used to evaluate parallel reductions of <code>shareable</code> iterators on GPUs, with runtime that scales in proportion to the base-2 logarithm of iterator length.</p><p>Any broadcast expression over <code>shareable</code> iterators can have its output container automatically allocated in the form of a <a href="#ClimaComms.shmem_array"><code>shmem_array</code></a>. Non-<code>shareable</code> iterators can also be used in broadcast expressions with <code>shareable</code> ones, but the resulting output containers may not be inferred correctly if the non-<code>shareable</code> iterators have different dimensions than the <code>shareable</code> ones.</p><p>Every <code>shareable</code> iterator has an internal <code>auto_sync</code> flag that determines whether <a href="#ClimaComms.auto_sync!"><code>auto_sync!</code></a> should be called after every loop or reduction. By default, this flag is always set to <code>true</code>, but in certain situations it can be set to <code>false</code> using <a href="#ClimaComms.disable_auto_sync"><code>disable_auto_sync</code></a>, which may improve performance.</p><p>Since global memory is typically only used for storing the final outputs of computations, rather than caching intermediate data like shared memory, <code>auto_sync!</code> only synchronizes threads that modify shared memory arrays. If global memory arrays are used to cache intermediate data instead of shared memory arrays, loops and reductions may need to be explicitly synchronized using <a href="#ClimaComms.sync_shmem_threads!"><code>sync_shmem_threads!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L42-L77">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.set_metadata" href="#ClimaComms.set_metadata"><code>ClimaComms.set_metadata</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_metadata(itr, metadata)</code></pre><p>Adds metadata to a <a href="#ClimaComms.shareable"><code>shareable</code></a> iterator that can be inferred during compilation, allowing loops and reductions over the iterator to be unrolled.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L116-L121">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.disable_auto_sync" href="#ClimaComms.disable_auto_sync"><code>ClimaComms.disable_auto_sync</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">disable_auto_sync(itr)</code></pre><p>Sets the <code>auto_sync</code> flag of a <a href="#ClimaComms.shareable"><code>shareable</code></a> iterator to <code>false</code>, so that the iterator can be used in a loop or reduction without being followed by a call to <a href="#ClimaComms.auto_sync!"><code>auto_sync!</code></a>. This is safe to use in the following scenarios:</p><ul><li>Looping over a <code>shareable</code> iterator without writing new data to shared memory or global memory that will need to be read by other threads. For example, a loop that just saves the final result of a computation to global memory should not be synchronized.</li><li>Running two consecutive loops that independently modify the same values in an array. For example, if a loop modifies the value at each index in an <code>array</code>, like <code>array .= sin.(array)</code>, and then another loop modifies the value at each index again without reading data from adjacent indices, like <code>array .*= 2</code>, the first loop over the <code>array</code> should not be synchronized.</li><li>Applying a reduction operator to an array and then only using the result in <a href="#ClimaComms.@unique_shmem_thread"><code>@unique_shmem_thread</code></a> expressions. Without synchronization, the result of any reduction operator is only guaranteed to be correct in threads that are part of the first warp in each GPU block. The implementation of <code>@unique_shmem_thread</code> guarantees that it will always choose one of these threads, so the expression it executes will have the correct result regardless of whether automatic synchronization is disabled. If the result is not needed in other threads, the reduction should not be synchronized.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L129-L152">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.auto_sync!" href="#ClimaComms.auto_sync!"><code>ClimaComms.auto_sync!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">auto_sync!(itr)</code></pre><p>Synchronizes GPU threads with access to the same <a href="#ClimaComms.shareable"><code>shareable</code></a> iterators, if the <code>auto_sync</code> flag of the given <code>shareable</code> iterator is set to <code>true</code>. On CPU devices, this function does nothing. Calls to <code>auto_sync!</code> are automatically inserted into most loops and reductions over <code>shareable</code> iterators, but custom loop functions may require explicit calls to <code>auto_sync!</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L156-L164">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.sync_shmem_threads!" href="#ClimaComms.sync_shmem_threads!"><code>ClimaComms.sync_shmem_threads!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">sync_shmem_threads!(device)</code></pre><p>Internal function called by <a href="#ClimaComms.auto_sync!"><code>auto_sync!</code></a> for <a href="#ClimaComms.shareable"><code>shareable</code></a> iterators whose <code>auto_sync</code> flags are set to <code>true</code>. Non-standard operations with loops or reductions may require explicit calls to <code>sync_shmem_threads!</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L168-L174">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shmem_array" href="#ClimaComms.shmem_array"><code>ClimaComms.shmem_array</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shmem_array(itr, [T], [dims])
shmem_array(device, T, dims)</code></pre><p>Device-flexible array whose element type <code>T</code> and dimensions <code>dims</code> are known during compilation, which corresponds to a static shared memory array on a GPU. Shared memory can be jointly modified by the threads in each GPU block, allowing kernels to have interdependencies between threads. On CPU devices, which do not provide access to high-performance shared memory, a <code>shmem_array</code> instead corresponds to a statically-sized <code>MArray</code> stored in register memory. Shared memory on a GPU and register memory on a CPU are both much faster to access and modify than the global memory used by <code>Array</code>s and <code>CuArray</code>s.</p><p>The recommended method for this function uses a <a href="#ClimaComms.shareable"><code>shareable</code></a> iterator to determine the device, a default element type, and a default array size, and an alternative method that directly accepts those parameters is also available. However, the alternative method does not propagate additional metadata from the <code>shareable</code> iterator that is required for unrolling of loops and reductions, so using it disables automatic unrolling of operations on the resulting array. If the default element type or dimensions of a <code>shareable</code> iterator cannot be inferred during compilation, inferrable values of <code>T</code> or <code>dims</code> need to be passed to the <code>shmem_array</code> function to override the default values.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L321-L343">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.@unique_shmem_thread" href="#ClimaComms.@unique_shmem_thread"><code>ClimaComms.@unique_shmem_thread</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@unique_shmem_thread itr ...</code></pre><p>Isolates an expression that should only be evaluated on a single thread in a <a href="#ClimaComms.@threaded"><code>@threaded</code></a> loop with an <a href="#ClimaComms.@shmem_threaded"><code>@shmem_threaded</code></a> iterator. For example, the result of a reduction over shared memory arrays can only be written to some specific address in global memory within a <code>@unique_shmem_thread</code> expression, since multiple threads simultaneously writing to the same index can lead to race conditions.</p><p>Any call to <a href="#ClimaComms.auto_sync!"><code>auto_sync!</code></a> in a <code>@unique_shmem_thread</code> expression can lead to deadlock, as the thread that issues a request for synchronization will be stuck waiting for other threads that never issue one. Since loops and reductions over shared memory generally require thread synchronization, they should not be used in <code>@unique_shmem_thread</code> expressions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L352-L367">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.unique_shmem_thread" href="#ClimaComms.unique_shmem_thread"><code>ClimaComms.unique_shmem_thread</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">unique_shmem_thread(f, itr)</code></pre><p>Functional form of <a href="#ClimaComms.@unique_shmem_thread"><code>@unique_shmem_thread</code></a>, equivalent to the expression <code>@unique_shmem_thread itr f()</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L372-L377">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shmem_reduce!" href="#ClimaComms.shmem_reduce!"><code>ClimaComms.shmem_reduce!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shmem_reduce!(op, [dest], itr; [init])</code></pre><p>Device-flexible version of <code>reduce(op, itr; [init])</code>, where <code>itr</code> is a <a href="#ClimaComms.shareable"><code>shareable</code></a> iterator that supports <code>setindex!</code>. When <code>dest</code> is also specified, the reduced value is written to it; otherwise, the value is returned at the end of the function.</p><p>On GPU devices, <code>shmem_reduce!</code> is parallelized across the threads in each block, so that its runtime that is roughly proportional to <code>log(length(itr))</code>, as long as the block size is no smaller than <code>length(itr)</code>. To enable this parallelization, the <code>itr</code> is used as a cache for intermediate data, so the values in it should not be used after this function is called. On CPU devices, <code>shmem_reduce!</code> is equivalent to the standard <code>reduce</code> function, and the <code>itr</code> is not overwritten. The order in which <code>shmem_reduce!</code> evaluates <code>op</code> is device-dependent, so reductions of floating-point values are not always guaranteed to be bitwise reproducible.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L381-L398">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shmem_mapreduce!" href="#ClimaComms.shmem_mapreduce!"><code>ClimaComms.shmem_mapreduce!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shmem_mapreduce!(f, op, [dest], itr; [init])</code></pre><p>Device-flexible version of <code>mapreduce(f, op, itr; [init])</code>, where <code>itr</code> is a <a href="#ClimaComms.shareable"><code>shareable</code></a> iterator that supports <code>setindex!</code>. When <code>dest</code> is also specified, the reduced value is written to it; otherwise, the value is returned at the end of the function.</p><p>On GPU devices, <code>shmem_mapreduce!</code> is a combination of <code>map!(f, itr, itr)</code> and <code>shmem_reduce!(op, itr; init)</code>. On CPU devices, <code>shmem_mapreduce!</code> is equivalent to the standard <code>mapreduce</code> function, and the <code>itr</code> is not overwritten.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L430-L441">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shmem_any!" href="#ClimaComms.shmem_any!"><code>ClimaComms.shmem_any!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shmem_any!([f], [dest], itr)</code></pre><p>Device-flexible version of <code>any([f], itr)</code>, equivalent to calling <a href="#ClimaComms.shmem_reduce!"><code>shmem_reduce!</code></a> or <a href="#ClimaComms.shmem_mapreduce!"><code>shmem_mapreduce!</code></a> with the <code>|</code> operator.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L455-L461">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shmem_all!" href="#ClimaComms.shmem_all!"><code>ClimaComms.shmem_all!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shmem_all!([f], [dest], itr)</code></pre><p>Device-flexible version of <code>all([f], itr)</code>, equivalent to calling <a href="#ClimaComms.shmem_reduce!"><code>shmem_reduce!</code></a> or <a href="#ClimaComms.shmem_mapreduce!"><code>shmem_mapreduce!</code></a> with the <code>&amp;</code> operator.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L455-L461">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shmem_sum!" href="#ClimaComms.shmem_sum!"><code>ClimaComms.shmem_sum!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shmem_sum!([f], [dest], itr; [init])</code></pre><p>Device-flexible version of <code>sum([f], itr; [init])</code>, equivalent to calling <a href="#ClimaComms.shmem_reduce!"><code>shmem_reduce!</code></a> or <a href="#ClimaComms.shmem_mapreduce!"><code>shmem_mapreduce!</code></a> with the <code>+</code> operator.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L472-L478">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shmem_prod!" href="#ClimaComms.shmem_prod!"><code>ClimaComms.shmem_prod!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shmem_prod!([f], [dest], itr; [init])</code></pre><p>Device-flexible version of <code>prod([f], itr; [init])</code>, equivalent to calling <a href="#ClimaComms.shmem_reduce!"><code>shmem_reduce!</code></a> or <a href="#ClimaComms.shmem_mapreduce!"><code>shmem_mapreduce!</code></a> with the <code>*</code> operator.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L472-L478">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shmem_maximum!" href="#ClimaComms.shmem_maximum!"><code>ClimaComms.shmem_maximum!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shmem_maximum!([f], [dest], itr; [init])</code></pre><p>Device-flexible version of <code>maximum([f], itr; [init])</code>, equivalent to calling <a href="#ClimaComms.shmem_reduce!"><code>shmem_reduce!</code></a> or <a href="#ClimaComms.shmem_mapreduce!"><code>shmem_mapreduce!</code></a> with the <code>max</code> operator.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L472-L478">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.shmem_minimum!" href="#ClimaComms.shmem_minimum!"><code>ClimaComms.shmem_minimum!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">shmem_minimum!([f], [dest], itr; [init])</code></pre><p>Device-flexible version of <code>minimum([f], itr; [init])</code>, equivalent to calling <a href="#ClimaComms.shmem_reduce!"><code>shmem_reduce!</code></a> or <a href="#ClimaComms.shmem_mapreduce!"><code>shmem_mapreduce!</code></a> with the <code>min</code> operator.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/shareable.jl#L472-L478">source</a></section></article><h2 id="Contexts"><a class="docs-heading-anchor" href="#Contexts">Contexts</a><a id="Contexts-1"></a><a class="docs-heading-anchor-permalink" href="#Contexts" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.AbstractCommsContext" href="#ClimaComms.AbstractCommsContext"><code>ClimaComms.AbstractCommsContext</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractCommsContext</code></pre><p>The base type for a communications context. Each backend defines a concrete subtype of this.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L46-L51">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.SingletonCommsContext" href="#ClimaComms.SingletonCommsContext"><code>ClimaComms.SingletonCommsContext</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SingletonCommsContext(device=device())</code></pre><p>A singleton communications context, used for single-process runs. <a href="#ClimaComms.AbstractCPUDevice"><code>ClimaComms.AbstractCPUDevice</code></a> and <a href="#ClimaComms.CUDADevice"><code>ClimaComms.CUDADevice</code></a> device options are currently supported.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/singleton.jl#L1-L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.MPICommsContext" href="#ClimaComms.MPICommsContext"><code>ClimaComms.MPICommsContext</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">MPICommsContext()
MPICommsContext(device)
MPICommsContext(device, comm)</code></pre><p>A MPI communications context, used for distributed runs. <a href="#ClimaComms.AbstractCPUDevice"><code>AbstractCPUDevice</code></a> and <a href="#ClimaComms.CUDADevice"><code>CUDADevice</code></a> device options are currently supported.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/mpi.jl#L1-L8">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.AbstractGraphContext" href="#ClimaComms.AbstractGraphContext"><code>ClimaComms.AbstractGraphContext</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractGraphContext</code></pre><p>A context for communicating between processes in a graph.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L156-L160">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.context" href="#ClimaComms.context"><code>ClimaComms.context</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ClimaComms.context(device=device())</code></pre><p>Construct a default communication context.</p><p>By default, it will try to determine if it is running inside an MPI environment variables are set; if so it will return a <a href="#ClimaComms.MPICommsContext"><code>MPICommsContext</code></a>; otherwise it will return a <a href="#ClimaComms.SingletonCommsContext"><code>SingletonCommsContext</code></a>.</p><p>Behavior can be overridden by setting the <code>CLIMACOMMS_CONTEXT</code> environment variable to either <code>MPI</code> or <code>SINGLETON</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L24-L35">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.graph_context" href="#ClimaComms.graph_context"><code>ClimaComms.graph_context</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">graph_context(context::AbstractCommsContext,
              sendarray, sendlengths, sendpids,
              recvarray, recvlengths, recvpids)</code></pre><p>Construct a communication context for exchanging neighbor data via a graph.</p><p>Arguments:</p><ul><li><code>context</code>: the communication context on which to construct the graph context.</li><li><code>sendarray</code>: array containing data to send</li><li><code>sendlengths</code>: list of lengths of data to send to each process ID</li><li><code>sendpids</code>: list of processor IDs to send</li><li><code>recvarray</code>: array to receive data into</li><li><code>recvlengths</code>: list of lengths of data to receive from each process ID</li><li><code>recvpids</code>: list of processor IDs to receive from</li></ul><p>This should return an <code>AbstractGraphContext</code> object.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L163-L180">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Adapt.adapt_structure-Tuple{Type{&lt;:AbstractArray}, ClimaComms.AbstractCommsContext}" href="#Adapt.adapt_structure-Tuple{Type{&lt;:AbstractArray}, ClimaComms.AbstractCommsContext}"><code>Adapt.adapt_structure</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">Adapt.adapt_structure(::Type{&lt;:AbstractArray}, context::AbstractCommsContext)</code></pre><p>Adapt a given context to a context with a device associated with the given array type.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">Adapt.adapt_structure(Array, ClimaComms.context(ClimaComms.CUDADevice())) -&gt; ClimaComms.CPUSingleThreaded()</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>By default, adapting to <code>Array</code> creates a <code>CPUSingleThreaded</code> device, and there is currently no way to conver to a CPUMultiThreaded device.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/adapt.jl#L3-L17">source</a></section></article><h2 id="Logging"><a class="docs-heading-anchor" href="#Logging">Logging</a><a id="Logging-1"></a><a class="docs-heading-anchor-permalink" href="#Logging" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.OnlyRootLogger" href="#ClimaComms.OnlyRootLogger"><code>ClimaComms.OnlyRootLogger</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">OnlyRootLogger()
OnlyRootLogger(ctx::AbstractCommsContext)</code></pre><p>Return a logger that silences non-root processes.</p><p>If no context is passed, obtain the default context via <a href="#ClimaComms.context"><code>context</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/logging.jl#L5-L12">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.MPILogger" href="#ClimaComms.MPILogger"><code>ClimaComms.MPILogger</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">MPILogger(context::AbstractCommsContext)
MPILogger(iostream, context)</code></pre><p>Add a rank prefix before log messages.</p><p>Outputs to <code>stdout</code> if no IOStream is given.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/logging.jl#L23-L30">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.FileLogger" href="#ClimaComms.FileLogger"><code>ClimaComms.FileLogger</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">FileLogger(context, log_dir; log_stdout = true, min_level = Logging.Info)</code></pre><p>Log MPI ranks to different files within the <code>log_dir</code>.</p><p>The minimum logging level is set using <code>min_level</code>. If <code>log_stdout = true</code>, root process logs will be sent to stdout as well.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/logging.jl#L44-L51">source</a></section></article><h2 id="Context-operations"><a class="docs-heading-anchor" href="#Context-operations">Context operations</a><a id="Context-operations-1"></a><a class="docs-heading-anchor-permalink" href="#Context-operations" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.init" href="#ClimaComms.init"><code>ClimaComms.init</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">(pid, nprocs) = init(ctx::AbstractCommsContext)</code></pre><p>Perform any necessary initialization for the specified backend. Return a tuple of the processor ID and the number of participating processors.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L54-L59">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.mypid" href="#ClimaComms.mypid"><code>ClimaComms.mypid</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">mypid(ctx::AbstractCommsContext)</code></pre><p>Return the processor ID.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L62-L66">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.iamroot" href="#ClimaComms.iamroot"><code>ClimaComms.iamroot</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">iamroot(ctx::AbstractCommsContext)</code></pre><p>Return <code>true</code> if the calling processor is the root processor.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L69-L73">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.nprocs" href="#ClimaComms.nprocs"><code>ClimaComms.nprocs</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">nprocs(ctx::AbstractCommsContext)</code></pre><p>Return the number of participating processors.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L76-L80">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.abort" href="#ClimaComms.abort"><code>ClimaComms.abort</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">abort(ctx::CC, status::Int) where {CC &lt;: AbstractCommsContext}</code></pre><p>Terminate the caller and all participating processors with the specified <code>status</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L147-L152">source</a></section></article><h2 id="Collective-operations"><a class="docs-heading-anchor" href="#Collective-operations">Collective operations</a><a id="Collective-operations-1"></a><a class="docs-heading-anchor-permalink" href="#Collective-operations" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.barrier" href="#ClimaComms.barrier"><code>ClimaComms.barrier</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">barrier(ctx::CC) where {CC &lt;: AbstractCommsContext}</code></pre><p>Perform a global synchronization across all participating processors.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L84-L88">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.reduce" href="#ClimaComms.reduce"><code>ClimaComms.reduce</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">reduce(ctx::CC, val, op) where {CC &lt;: AbstractCommsContext}</code></pre><p>Perform a reduction across all participating processors, using <code>op</code> as the reduction operator and <code>val</code> as this rank&#39;s reduction value. Return the result to the first processor only.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L92-L98">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.reduce!" href="#ClimaComms.reduce!"><code>ClimaComms.reduce!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">reduce!(ctx::CC, sendbuf, recvbuf, op)
reduce!(ctx::CC, sendrecvbuf, op)</code></pre><p>Performs elementwise reduction using the operator <code>op</code> on the buffer <code>sendbuf</code>, storing the result in the <code>recvbuf</code> of the process. If only one <code>sendrecvbuf</code> buffer is provided, then the operation is performed in-place.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L102-L109">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.allreduce" href="#ClimaComms.allreduce"><code>ClimaComms.allreduce</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">allreduce(ctx::CC, sendbuf, op)</code></pre><p>Performs elementwise reduction using the operator <code>op</code> on the buffer <code>sendbuf</code>, allocating a new array for the result. <code>sendbuf</code> can also be a scalar, in which case <code>recvbuf</code> will be a value of the same type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L112-L117">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.allreduce!" href="#ClimaComms.allreduce!"><code>ClimaComms.allreduce!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">allreduce!(ctx::CC, sendbuf, recvbuf, op)
allreduce!(ctx::CC, sendrecvbuf, op)</code></pre><p>Performs elementwise reduction using the operator <code>op</code> on the buffer <code>sendbuf</code>, storing the result in the <code>recvbuf</code> of all processes in the group. <code>Allreduce!</code> is equivalent to a <code>Reduce!</code> operation followed by a <code>Bcast!</code>, but can lead to better performance. If only one <code>sendrecvbuf</code> buffer is provided, then the operation is performed in-place.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L120-L128">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.bcast" href="#ClimaComms.bcast"><code>ClimaComms.bcast</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">bcast(ctx::AbstractCommsContext, object)</code></pre><p>Broadcast <code>object</code> from the root process to all other processes. The value of <code>object</code> on non-root processes is ignored.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L139-L144">source</a></section></article><h3 id="Graph-exchange"><a class="docs-heading-anchor" href="#Graph-exchange">Graph exchange</a><a id="Graph-exchange-1"></a><a class="docs-heading-anchor-permalink" href="#Graph-exchange" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.start" href="#ClimaComms.start"><code>ClimaComms.start</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">start(ctx::AbstractGraphContext)</code></pre><p>Initiate graph data exchange.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L184-L188">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.progress" href="#ClimaComms.progress"><code>ClimaComms.progress</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">progress(ctx::AbstractGraphContext)</code></pre><p>Drive communication. Call after <code>start</code> to ensure that communication proceeds asynchronously.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L191-L196">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaComms.finish" href="#ClimaComms.finish"><code>ClimaComms.finish</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">finish(ctx::AbstractGraphContext)</code></pre><p>Complete the communications step begun by <code>start()</code>. After this returns, data received from all neighbors will be available in the stage areas of each neighbor&#39;s receive buffer.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaComms.jl/blob/1ba44a073156d9bd17e0606ddb7d48337d4cd402/src/context.jl#L199-L205">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../faqs/">« Frequently Asked Questions</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Wednesday 3 September 2025 11:09">Wednesday 3 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
